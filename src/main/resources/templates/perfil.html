<!DOCTYPE html>
<html lang="pt-BR" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Meu Perfil</title>
	<link rel="icon" th:href="@{/images/SIMS_CORACAO_VERDE.png}" type="image/x-icon">
	<link rel="stylesheet" th:href="@{/styles/main.css}">
	<link rel="stylesheet" href="assets/fontawesome-6.4.0/css/all.min.css">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"
		integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
	<!-- Google tag (gtag.js) -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=G-194JYMPFEE"></script>
	<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
		integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
		crossorigin="anonymous"></script>

	<script>
		window.dataLayer = window.dataLayer || [];
		function gtag() {
			dataLayer.push(arguments);
		}
		gtag('js', new Date());

		gtag('config', 'G-194JYMPFEE');
	</script>
</head>

<body style="background-color: #f5f5f5; display: flex; margin: 0;">

	<div class="main-container">

		<header class="home-header">
			<nav class="navbar navbar-expand-lg navbar-light bg">
				<a th:href="@{/}" onclick="ScrollTop()">
					<div class="div-logo">
						<img loading="lazy" th:src="@{/images/SIMS_VERDE_PASTEL.svg}" id="logo"
							alt="Logo do Projeto SIMS, contendo um desenho de coração com o ritmo sinusal no meio na cor verde, com a sigla 'SIMS' escrita abaixo ">
					</div>
				</a>
				<button class="navbar-toggler" type="button" data-toggle="collapse"
					data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
					aria-label="Toggle navigation" id="toggle-navbar">
					<span class="navbar-toggler-icon"></span>
				</button>
				<div class="collapse navbar-collapse" id="navbarSupportedContent">
					<ul class="navbar-nav mr-auto mt-2 mt-lg-0" id="navbar">
						<li class="nav-item dropdown">
							<a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button"
								data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
								Baixada Santista
							</a>
							<div class="dropdown-menu" aria-labelledby="navbarDropdown" id="dropdown-menu">
								<a class="dropdown-item" th:href="@{/santos}">Santos</a>
								<a class="dropdown-item" th:href="@{/praiagrande}">Praia Grande</a>
								<a class="dropdown-item" th:href="@{/saovicente}">São Vicente</a>
								<a class="dropdown-item" th:href="@{/guaruja}">Guarujá</a>
								<a class="dropdown-item" th:href="@{/cubatao}">Cubatão</a>
								<a class="dropdown-item" th:href="@{/itanhaem}">Itanhaém</a>
								<a class="dropdown-item" th:href="@{/peruibe}">Peruíbe</a>
								<a class="dropdown-item" th:href="@{/bertioga}">Bertioga</a>
								<a class="dropdown-item" th:href="@{/mongagua}">Mongaguá</a>
							</div>
						</li>
						<div id="login-icon">
							<a th:href="@{/meu-perfil}" th:if="${usuarioLogado}"><i class="fa-solid fa-user"></i> Meu
								Perfil </a>
							<a th:href="@{/logout}" th:if="${usuarioLogado}"><i
									class="fa-solid fa-arrow-right-from-bracket" style="color: #ffffff"></i>  Sair</a>
							<a th:href="@{/login}" th:unless="${usuarioLogado}"><i class="fa-solid fa-user"></i>
								Login</a>
						</div>
					</ul>
				</div>
			</nav>
		</header><br>

		<main class="perfil">
			<div style="margin-left: -200px;">
				<div style="border: 7px dotted #333; width: 400px; padding: 25px; margin-top: 115px;"
					class="mudarPerfil">

					<h2 style="text-align: center; margin-bottom: 25px; ">Meu Perfil</h2>
					<br>

					<p><strong>Usuário:</strong> <span id="nmUsuario" th:text="${usuario.nomeUsuario}"></span></p>
					<p><strong>Nome Completo:</strong> <span id="nm" th:text="${usuario.nomeCompleto}"></span></p>
					<p><strong>E-mail:</strong> <span id="em" th:text="${usuario.email}"></span></p>
					<p><strong>Senha:</strong> <span id="sen">******</span></p>
					<p><strong>Data de nascimento:</strong> <span id="dtNascimento"
							th:text="${usuario.dataNascimento}"></span></p>
					<br>
					<div style="display: flex; justify-content: center; align-items: center;">

						<button type="button" class="btn btn-dark" data-toggle="modal" data-target="#ModalEditar"
							style="margin-right: 20px;">
							Alterar Dados
						</button>
						<button type="button" class="btn btn-dark" data-toggle="modal" data-target="#ModalExcluir">
							Excluir Conta
						</button>
					</div>
				</div>

				<div class="modal fade" id="ModalEditar" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
					aria-hidden="true">
					<div class="modal-dialog" role="document">
						<div class="modal-content">
							<div class="modal-header">
								<h5 class="modal-title" id="exampleModalLabel">Alterar Dados</h5>
								<button type="button" class="close" data-dismiss="modal" aria-label="Fechar">
									<span aria-hidden="true">&times;</span>
								</button>
							</div>
							<div class="modal-body">

								<p style="color: red;"> Estes são seus dados. Altere apenas o que realmente quiser que
									seja modificado! </p>
								<form th:object="${usuario}">
									<label for="nomeUsuario">Nome de Usuário:</label>
									<input type="text" th:field="*{nomeUsuario}" id="alterar-nome-usuario"
										maxlength="20" required>

									<label for="alterar-nome-completo">Nome Completo:</label>
									<input type="text" th:field="*{nomeCompleto}" id="alterar-nome-completo" required>

									<label for="email">E-mail:</label>
									<input type="email" th:field="*{email}" id="alterar-email" required>

									<label for="senha">Senha:</label>
									<input type="password" th:field="*{senha}" id="alterar-senha" minlength="6"
										required>

									<label for="dataNascimento">Data de Nascimento:</label>
									<input type="date" th:field="*{dataNascimento}" id="alterar-data-nascimento"
										min="1950-01-01" max="2007-01-01" required>

									<div class="modal-footer">
										<button type="button" class="btn btn-secondary"
											data-dismiss="modal">Cancelar</button>
									<button type="submit" class="btn btn-success" onclick="enviarFormulario();">Salvar Alterações</button>
									</div>
								</form>
							</div>

						</div>
					</div>
				</div>

				<div class="modal fade" id="ModalExcluir" tabindex="-1" role="dialog"
					aria-labelledby="exampleModalLabel" aria-hidden="true">
					<div class="modal-dialog" role="document">
						<div class="modal-content">
							<div class="modal-header">
								<h5 class="modal-title" id="exampleModalLabel">Excluir Conta</h5>
								<button type="button" class="close" data-dismiss="modal" aria-label="Fechar">
									<span aria-hidden="true">&times;</span>
								</button>
							</div>
							<div class="modal-body">

								<p style="font-size: 20px;"> Você realmente deseja excluir sua conta? </p>
								<br>
								<p style="color: red;"> *Uma vez excluída, não é possível recuperá-la!</p>

							</div>
							<div class="modal-footer">
								<button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
							<button type="button" class="btn btn-success" id="btnExcluirDefinitivamente"
									data-usuario-id="${usuario.id}" th:attr="data-usuario-id=${usuario.id}">
								Excluir Definitivamente
							</button>

							</div>
						</div>
					</div>
				</div>
			</div>
			<div style="margin-left:100px;">
				<div style="margin-top: 30px; margin-bottom: 50px;">
					<h2 style="text-align: center;">Notícias Salvas</h2>
				</div>
				<div style="max-height: calc(80vh - 50px); overflow-y: auto; margin-top: 15px;">

					<div class="row">
						<div th:each="noticia : ${noticiasList}" class="col-md-6">
							<a th:href="@{${noticia.urlNoticia}}" target="_blank" class="card mb-4"
								style="height: 500px;">
								<img class="card-img-top" th:src="${noticia.imagem}" alt="Imagem da Notícia"
									loading="lazy" style="height: 200px; object-fit: cover;">
								<div class="card-body">
									<p class="card-title" th:text="${noticia.data}"></p>
									<h5 class="card-title" th:text="${noticia.title}">Título da Notícia</h5>
									<p class="card-text" th:text="${noticia.content}">Conteúdo da Notícia</p>
								</div>
							</a>
						</div>
					</div>
				</div>
			</div>

		</main>

		<footer>
			<div class="icons">
				<a href="https://www.instagram.com/projeto.sims/" target="_blank"><i
						class="fa-brands fa-instagram"></i></a>
				<a href="https://www.linkedin.com/in/projeto-sims-5610002a1/" target="_blank"><i
						class="fa-brands fa-linkedin-in"></i></a>
				<a href="https://mail.google.com/mail/u/0/?fs=1&tf=cm&to=appsims.suporte@gmail.com" target="_blank"><i
						class="fa-solid fa-envelope"></i></a>
			</div>
			<div class="infos">
				<a th:href="@{/sobre}">
					<p>Sobre nós</p>
				</a>

				<a th:href="@{/termos}">
					<p>Termos de Uso</p>
				</a>

				<a th:href="@{/privacidade}">
					<p>Política de Privacidade</p>
				</a>
			</div>
			<div class="sub-footer">
				<p>Esse é um projeto de trabalho acadêmico do curso de SI FATEC Rubens Lara.</p>
			</div>
		</footer>
		<script src="./scripts/main.js"></script>

	</div>

	<script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js"
		integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
		crossorigin="anonymous"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js"
		integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
		crossorigin="anonymous"></script>

	<script src="https://code.jquery.com/jquery-3.6.0.min.js" crossorigin="anonymous"></script>

	<script th:inline="javascript">
	/*<![CDATA[*/

	$(document).ready(function () {
		$('#btnExcluirDefinitivamente').click(function () {
			var usuarioId = $(this).data('usuario-id');
			excluirUsuario(usuarioId);
		});

		function excluirUsuario(usuarioId) {
			jQuery.ajax({
				url: '/excluir-usuario/' + usuarioId,
				type: 'DELETE',
				success: function (data) {
					console.log('Exclusão definitiva realizada com sucesso');
					window.location.href = '/login';
				},
				error: function (error) {
					console.error('Erro ao excluir definitivamente:', error);
				}
			});
		}
	});

	function enviarFormulario() {
		let nomeUsuario = $('#alterar-nome-usuario').val();
		let nomeCompleto = $('#alterar-nome-completo').val();
		let email = $('#alterar-email').val();
		let senha = $('#alterar-senha').val();
		let dataNascimento = $('#alterar-data-nascimento').val();

		$.post({
			url: "/alterar-usuario",
			contentType: 'application/json',
			data: JSON.stringify({
				nomeUsuario: nomeUsuario,
				nomeCompleto: nomeCompleto,
				email: email,
				senha: senha,
				dataNascimento: dataNascimento,
			})
		})
				.done(function(data) {
					// Callback de sucesso
					console.log('Dados enviados com sucesso:', data);

					// Recarregar a página
					location.reload();
				})
				.fail(function(error) {
					console.error('Erro ao enviar dados:', error);
				});
	}

	/*]]>*/
</script>


</body>

</html>